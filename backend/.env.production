# 货运门户生产环境配置模板
# 请复制此文件为 .env.production 并填写实际值
# 警告: 此文件包含敏感信息，请勿提交到版本控制

# ============================================
# 基础服务配置
# ============================================

# 数据库配置 - 阿里云 RDS MySQL
# 格式: mysql://用户名:密码@主机:端口/数据库名?sslaccept=strict
DATABASE_URL="mysql://freight_user:YOUR_STRONG_PASSWORD@rm-xxx.mysql.rds.aliyuncs.com:3306/freight_portal_prod?connection_limit=20&pool_timeout=30"

# 只读数据库（用于报表查询，可选）
DATABASE_READ_URL="mysql://freight_read:YOUR_STRONG_PASSWORD@rm-xxx.mysql.rds.aliyuncs.com:3306/freight_portal_prod?connection_limit=10"

# Redis 配置 - 阿里云 Redis
# 集群模式: redis://:密码@主机:端口
REDIS_URL="redis://:YOUR_REDIS_PASSWORD@r-xxx.redis.rds.aliyuncs.com:6379"
REDIS_DB=0

# Redis 缓存配置
REDIS_CACHE_TTL=3600
REDIS_SESSION_TTL=86400

# ============================================
# 服务器配置
# ============================================

# 服务端口
PORT=3000

# 环境标识
NODE_ENV="production"

# API 前缀
API_PREFIX="/api/v1"

# CORS 配置（生产环境应限制为实际域名）
CORS_ORIGIN="https://freight.yourdomain.com,https://admin.freight.yourdomain.com"

# 请求体大小限制
BODY_LIMIT="10mb"

# ============================================
# JWT 认证配置
# ============================================

# JWT 密钥 - 使用强随机字符串
# 生成方式: openssl rand -base64 64
JWT_SECRET="YOUR_JWT_SECRET_MIN_64_CHARS_LONG_RANDOM_STRING_HERE"

# Token 过期时间
JWT_EXPIRES_IN="15m"
JWT_REFRESH_EXPIRES_IN="7d"

# ============================================
# 4portun API 配置
# ============================================

# API 基础地址
FOURPORTUN_API_URL="https://prod-api.4portun.com"

# 应用凭证（从 4portun 平台获取）
FOURPORTUN_APPID="your-4portun-appid"
FOURPORTUN_SECRET="your-4portun-secret"

# Webhook 签名密钥（用于验证推送数据）
FOURPORTUN_WEBHOOK_SECRET="your-webhook-secret"

# 同步配置
FOURPORTUN_SYNC_INTERVAL="*/5 * * * *"  # 每5分钟
FOURPORTUN_SYNC_BATCH_SIZE=50
FOURPORTUN_SYNC_TIMEOUT=30000

# ============================================
# Kimi AI API 配置
# ============================================

# API 基础地址
KIMI_API_URL="https://api.moonshot.cn/v1"

# API 密钥（从 Moonshot 平台获取）
KIMI_API_KEY="your-kimi-api-key"

# 模型配置
KIMI_MODEL="moonshot-v1-8k"
KIMI_MAX_TOKENS=2048
KIMI_TEMPERATURE=0.7

# OCR 服务配置
KIMI_OCR_TIMEOUT=30000

# ============================================
# 阿里云 OSS 配置
# ============================================

# 存储区域
OSS_REGION="oss-cn-hangzhou"

# 存储空间名称
OSS_BUCKET="freight-portal-prod"

# 访问密钥（建议使用 RAM 子账号，仅授予 OSS 权限）
OSS_ACCESS_KEY_ID="your-access-key-id"
OSS_ACCESS_KEY_SECRET="your-access-key-secret"

# 自定义域名（可选，配置 CDN 加速）
OSS_CUSTOM_DOMAIN="https://cdn.yourdomain.com"

# 文件上传限制
OSS_MAX_SIZE=104857600  # 100MB
OSS_ALLOWED_TYPES="image/*,application/pdf,application/msword"

# 文件过期时间（天）
OSS_FILE_EXPIRY_DAYS=365

# ============================================
# 微信小程序配置
# ============================================

# 小程序 AppID
WECHAT_APPID="your-wechat-appid"

# 小程序密钥
WECHAT_SECRET="your-wechat-secret"

# 微信支付（如启用）
WECHAT_MCH_ID="your-merchant-id"
WECHAT_API_KEY="your-pay-api-key"
WECHAT_NOTIFY_URL="https://api.yourdomain.com/api/v1/payment/notify"

# ============================================
# 日志配置
# ============================================

# 日志级别: error, warn, info, debug, verbose
LOG_LEVEL="info"

# 日志存储路径
LOG_PATH="/var/log/freight-portal"

# 日志保留天数
LOG_RETENTION_DAYS=30

# 阿里云 SLS 配置
SLS_PROJECT="freight-portal-prod"
SLS_LOGSTORE="app-logs"
SLS_ENDPOINT="cn-hangzhou.log.aliyuncs.com"
SLS_ACCESS_KEY_ID="your-sls-access-key"
SLS_ACCESS_KEY_SECRET="your-sls-secret"

# ============================================
# 监控告警配置
# ============================================

# 阿里云 ARMS 配置
ARMS_LICENSE_KEY="your-arms-license-key"
ARMS_APP_NAME="freight-portal-api"
ARMS_REGION="cn-hangzhou"

# 应用性能监控
APM_ENABLED=true
APM_SAMPLE_RATE=0.1

# 健康检查配置
HEALTH_CHECK_TIMEOUT=5000
HEALTH_CHECK_INTERVAL=30000

# ============================================
# 限流与安全配置
# ============================================

# 全局限流: 每 IP 每分钟请求数
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# API 限流: 每用户每分钟请求数
API_RATE_LIMIT=1000

# 密码安全
BCRYPT_ROUNDS=12
PASSWORD_MIN_LENGTH=8

# 会话配置
SESSION_SECRET="your-session-secret"
SESSION_MAX_AGE=86400000

# ============================================
# 邮件通知配置（可选）
# ============================================

SMTP_HOST="smtp.qiye.aliyun.com"
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER="noreply@yourdomain.com"
SMTP_PASS="your-smtp-password"

# 通知邮箱
ALERT_EMAIL="ops@yourdomain.com"
ADMIN_EMAIL="admin@yourdomain.com"

# ============================================
# 备份配置
# ============================================

# 数据库备份
DB_BACKUP_ENABLED=true
DB_BACKUP_SCHEDULE="0 2 * * *"  # 每天凌晨2点
DB_BACKUP_RETENTION_DAYS=30

# 文件备份
FILE_BACKUP_ENABLED=true
FILE_BACKUP_SCHEDULE="0 3 * * *"  # 每天凌晨3点

# ============================================
# 功能开关
# ============================================

# 启用/禁用功能
FEATURE_AI_ASSISTANT=true
FEATURE_OCR=true
FEATURE_WECHAT_LOGIN=true
FEATURE_NOTIFICATION=true
FEATURE_BILLING=true

# 维护模式
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="系统维护中，请稍后访问"
