# 货代客户门户 - 需求规格说明书 V2.0

## 1. 项目背景
为货代公司客户提供一个统一的在线服务平台，替代传统的电话/邮件查询方式，提升客户服务效率和体验。

## 2. 用户角色

### 2.1 客户侧
| 角色 | 权限 | 描述 |
|------|------|------|
| 企业管理员 | 全权限 | 管理企业下所有子账号、查看所有数据 |
| 业务操作员 | 业务权限 | 下单、查询货物、管理委托 |
| 财务人员 | 财务权限 | 查看账单、发票、进行对账 |
| 只读用户 | 查看权限 | 仅查看货物状态，不可操作 |

### 2.2 平台侧
| 角色 | 职责 |
|------|------|
| 系统管理员 | 平台配置、用户管理 |
| 客服人员 | 处理客户咨询、异常处理 |
| 运营人员 | 数据报表、业务分析 |
| 销售代表 | 客户跟进、报价管理 |

## 3. 功能需求

### 3.1 用户认证与权限模块
- [ ] 企业客户注册（需审核）
- [ ] 多因子认证(MFA)
- [ ] 子账号邀请/管理
- [ ] 角色权限配置（RBAC）
- [ ] 单点登录(SSO)对接企业微信/钉钉
- [ ] 登录日志审计
- [ ] 密码策略管理
- [ ] API密钥管理

### 3.2 货物追踪与查询模块（核心）
- [ ] **集装箱号/提单号快速查询**（参考Flexport的搜索体验）
- [ ] **货物状态时间轴展示**（节点：订舱→装箱→报关→装船→在途→到港→清关→派送）
- [ ] **关键节点自动通知**（邮件/短信/微信推送）
- [ ] **异常状态预警**（延误、滞留、甩柜、海关查验等）
- [ ] **货物订阅管理**（批量订阅、取消订阅）
- [ ] **历史查询记录**
- [ ] **导出追踪报告**（PDF/Excel）

> **注：地图可视化功能暂不开发**

### 3.3 内部系统对接模块
- [ ] **现货库存API查询**（显示可售舱位、箱型、价格）
- [ ] **运价实时查询**（整箱/拼箱/空运/陆运）
- [ ] **船期/航班查询**（船名航次、ETD/ETA）
- [ ] **仓库库存状态**（进仓、出仓、库存量）
- [ ] **数据缓存策略**（减少内部系统压力）
- [ ] **对接日志与监控**

### 3.4 第三方平台同步模块

#### 主要数据供应商：四港物流宝(4portun)
- [ ] **箱货跟踪API** - 全球70+船司、全国10大口岸
  - 节点：放箱、提空箱、进港、海关放行、码头放行、离港、抵港、卸货、提重、还空
  - 海外码头：美日韩30+码头
  - 中国EIR：八大港区堆场数据
- [ ] **关务数据API 4.0** - 海+陆+空海关数据
  - 预配舱单、海关入库、通关审结、海关放行、装载舱单、结关
- [ ] **美国海关数据** - 空运/海运进口信息
- [ ] **海运综合API** - 多式联运（支线、内河、卡车）

#### 备用/补充数据源
- [ ] **船公司直连API**（优先级：COSCO、MSK、MSC、ONE）
- [ ] **港口数据对接**（上海、宁波、深圳、青岛等）

#### 同步机制
- [ ] **订阅推送模式**（Webhook实时推送）
- [ ] **定时拉取**（船期等低频数据）
- [ ] **失败重试机制**（指数退避）
- [ ] **数据冲突解决策略**

### 3.5 订单与委托管理模块
- [ ] **在线下单**（海运整箱FCL/拼箱LCL、空运、陆运、多式联运）
- [ ] **智能报价计算器**（输入起运港、目的港、货量自动报价）
- [ ] **委托单模板管理**（保存常用委托信息）
- [ ] **订单草稿保存**
- [ ] **订单状态流转**（待确认→已确认→执行中→已完成→已取消）
- [ ] **电子签名确认**（委托单、提单确认）
- [ ] **订单变更申请**
- [ ] **批量下单**（Excel导入）

### 3.6 财务中心模块
- [ ] **发票列表与下载**（形式发票、商业发票、税务发票）
- [ ] **账单明细查询**（费用明细、汇率、计费重）
- [ ] **在线支付**（支付宝、微信、银联、对公转账）
- [ ] **对账单生成与确认**（月度对账、差异标记）
- [ ] **费用预估计算器**（运费+附加费+税费预估）
- [ ] **信用额度管理**
- [ ] **付款记录查询**
- [ ] **逾期提醒**

### 3.8 AI 能力模块
- [ ] **智能客服机器人**
  - 货物状态问答（"我的货到哪里了？"）
  - 运价咨询（"上海到洛杉矶多少钱？"）
  - 船期查询（"下周有去汉堡的船吗？"）
  - 异常处理指引
- [ ] **OCR文档识别**
  - 提单识别（自动提取船名航次、箱号、货描）
  - 发票识别（自动录入费用信息）
  - 装箱单识别
- [ ] **到港时间预测**（基于历史数据+实时船期）
- [ ] **异常预警智能分析**（识别高风险货物）
- [ ] **智能推荐**
  - 最优航线推荐
  - 最佳出货时间推荐
  - 替代方案推荐（延误时）

### 3.9 消息通知中心（小程序内置）
- [ ] **微信模板消息通知**
  - 货物状态变更通知
  - 订单状态变更通知
  - 账单/发票通知
  - 异常预警通知
- [ ] **通知偏好设置**

## 4. 非功能需求

### 4.1 性能
- 页面首屏加载 < 2秒
- API响应时间 < 500ms（P95）
- 支持 1000+ 并发用户
- 支持 10万+ 日查询量
- 系统吞吐量：1000单/小时

### 4.2 安全
- 数据加密传输（HTTPS/TLS 1.3）
- 敏感数据加密存储（AES-256）
- API访问限流（Rate Limiting）
- 防SQL注入/XSS/CSRF
- 完整操作审计日志
- 数据备份策略（每日增量、每周全量）
- 灾难恢复方案（RTO<4h, RPO<1h）

### 4.3 可用性
- 系统可用性 99.9%
- 计划内维护窗口 < 4小时/月
- 支持蓝绿部署

### 4.4 可扩展性
- 微服务架构，支持水平扩展
- 数据库支持分库分表
- 缓存层支持集群

### 4.5 国际化
- 支持简体中文、繁体中文、英文
- 多时区支持
- 多币种支持（USD、CNY、EUR等）

## 5. 待确认事项
- [ ] 内部系统API接口文档（WMS/TMS/ERP）
- [ ] **4portun API接入申请**（接口文档、配额、费用）
- [ ] 4portun Webhook回调地址配置
- [ ] 客户现有数据量评估（历史订单、在途货物）
- [ ] 预算范围
- [ ] 上线时间规划
- [ ] 是否需要Web管理后台（供内部人员使用）
- [ ] 是否需要对接客户自有ERP系统

## 6. 参考竞品功能亮点

### Flexport
- SKU级货物追踪
- 碳排放计算器
- 供应链金融服务

### 运去哪
- "现舱特价专区"
- 30分钟预配信息出具
- 自动化风险预警推送
- 船东直连

### 四港物流宝(4portun)
- 全球70+船司数据覆盖
- 全国10大口岸+海外30+码头
- 关务数据4.0（海+陆+空）
- 多式联运跟踪（支线、内河、卡车）
- 美国海关数据支持

### DHL myDHLi
- 统一费率(FAK)透明报价
- 多式联运一键比价
- 数字化文档管理

### Kuehne+Nagel myKN
- 免费碳排放抵消
- 实时库存可视化
- 预测性分析

## 7. 技术栈建议

### 前端
- **小程序**: 微信小程序（原生/Taro/uni-app）
- **Web管理后台**: Next.js 14 + TypeScript + Tailwind CSS
- **UI组件**: TDesign小程序组件库 / shadcn/ui (Web端)

### 后端
- 框架: NestJS + TypeScript
- 数据库: PostgreSQL（主库）+ Redis（缓存）
- ORM: Prisma
- 消息队列: RabbitMQ / Bull
- 搜索引擎: Elasticsearch

### AI
- LLM: OpenAI GPT-4 / 文心一言 / Kimi
- OCR: 百度OCR / 腾讯OCR / Azure Form Recognizer

### 基础设施
- 容器化: Docker + Kubernetes
- CI/CD: GitHub Actions
- 监控: Prometheus + Grafana
- 日志: ELK Stack
