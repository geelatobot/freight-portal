# 货代客户门户 - 需求规格说明书 V3.1（最终版）

## 1. 项目概述

### 1.1 项目背景
为货代公司客户提供一个统一的在线服务平台，替代传统的电话/邮件查询方式，提升客户服务效率和体验。同时提供内部管理后台，供业务人员、客服人员、财务人员使用。

### 1.2 产品矩阵

| 产品 | 用户 | 主要功能 | 技术形式 |
|------|------|---------|---------|
| **客户Web端** | 货代客户 | 货物查询、下单、财务查询 | Web应用(PC/移动端适配) |
| **客户小程序** | 货代客户 | 货物查询、订单跟踪、消息通知 | 微信小程序 |
| **管理后台** | 内部员工 | 客户管理、订单管理、数据管理 | Web应用 |

### 1.3 集成范围（已确认）
- ✅ 四港物流宝API（4portun）- 已有API Key
- ✅ Kimi AI API - 智能客服
- ⏸️ 客户ERP系统 - 暂不自动对接，预留扩展
- ⏸️ 在线支付 - 暂不接入，线下对公转账

---

## 2. 用户角色

### 2.1 客户侧角色

| 角色 | 权限 | 描述 |
|------|------|------|
| 企业管理员 | 全权限 | 管理企业下所有子账号、查看所有数据、审批订单 |
| 业务操作员 | 业务权限 | 下单、查询货物、管理委托、查看账单 |
| 财务人员 | 财务权限 | 查看账单、发票、进行对账 |
| 只读用户 | 查看权限 | 仅查看货物状态，不可操作 |

### 2.2 平台侧角色

| 角色 | 职责 | 权限 |
|------|------|------|
| 系统管理员 | 平台配置、账号管理、权限分配 | 全部权限 |
| 客服人员 | 处理客户咨询、异常处理、订单跟进 | 客户管理、订单管理、消息发送 |
| 运营人员 | 数据查看、报表导出、业务分析 | 数据查看、报表导出 |
| 销售代表 | 客户跟进、报价管理、客户开发 | 客户管理、报价管理 |
| 财务人员 | 账单审核、发票管理、对账处理 | 财务管理、账单审核 |

---

## 3. 功能需求

### 3.1 客户Web端功能

#### 3.1.1 用户认证与账户管理
- [ ] 企业客户注册（需平台审核）
- [ ] 登录（账号密码/短信验证码/微信扫码）
- [ ] 忘记密码/重置密码
- [ ] 子账号管理（企业管理员可添加/禁用子账号）
- [ ] 个人信息维护
- [ ] 企业信息维护
- [ ] 登录日志查看

#### 3.1.2 货物追踪中心（核心功能）
- [ ] **快速查询**：输入箱号/提单号/订单号查询
- [ ] **货物列表**：显示该客户所有在途/历史货物
- [ ] **货物详情页**：
  - 货物基本信息（箱号、提单号、船名航次、起运港/目的港）
  - 状态时间轴（图形化展示节点进度）
  - 节点详情（时间、地点、状态说明）
  - 预计时间（ETD/ETA）
- [ ] **筛选与搜索**：按时间、状态、航线筛选
- [ ] **订阅管理**：订阅/取消订阅货物状态变更通知
- [ ] **异常标记**：显示延误、滞留等异常状态
- [ ] **导出功能**：导出货物清单（Excel）

#### 3.1.3 订单管理
- [ ] **在线下单**：
  - 海运整箱(FCL)下单
  - 海运拼箱(LCL)下单
  - 空运下单
  - 陆运下单
- [ ] **智能报价**：输入起运港、目的港、货量，获取预估费用
- [ ] **订单列表**：查看所有订单及状态
- [ ] **订单详情**：查看订单完整信息、处理进度
- [ ] **订单状态**：待确认→已确认→执行中→已完成→已取消
- [ ] **订单变更**：申请修改订单信息
- [ ] **订单取消**：申请取消订单（需审批）
- [ ] **常用地址**：保存常用收发货地址
- [ ] **委托单模板**：保存常用委托信息，快速下单

#### 3.1.4 财务中心
- [ ] **账单列表**：查看所有账单
- [ ] **账单详情**：费用明细、计费方式、汇率
- [ ] **发票管理**：
  - 发票列表与下载
  - 申请开票
  - 发票邮寄地址管理
- [ ] **对账单**：月度对账单查看与确认
- [ ] **费用预估**：输入货物信息，预估总费用
- [ ] **付款记录**：历史付款记录查询
- [ ] **信用额度**：查看可用信用额度
- [ ] **支付凭证上传**：线下转账后上传凭证

#### 3.1.5 消息通知
- [ ] 站内消息列表
- [ ] 消息分类（货物状态、订单状态、账单、系统公告）
- [ ] 消息详情查看
- [ ] 消息已读/未读标记
- [ ] 通知设置（开关各类通知）

#### 3.1.6 个人中心
- [ ] 账号信息
- [ ] 修改密码
- [ ] 绑定手机/邮箱
- [ ] 绑定微信（接收通知）
- [ ] 企业认证信息
- [ ] 常用联系人管理

---

### 3.2 客户小程序功能

#### 3.2.1 核心功能（与Web端一致）
- [ ] 货物快速查询（扫码/输入）
- [ ] 货物列表与详情
- [ ] 订单列表与详情
- [ ] 订单状态跟踪
- [ ] 账单查看
- [ ] 个人中心

#### 3.2.2 小程序特有功能
- [ ] **扫码查询**：扫描集装箱号/提单号二维码
- [ ] **微信模板消息推送**：
  - 货物状态变更通知
  - 订单状态变更通知
  - 账单/发票通知
  - 异常预警通知
- [ ] **分享功能**：分享货物跟踪给同事
- [ ] **一键拨号**：联系客服/销售

---

### 3.3 管理后台功能

#### 3.3.1 客户管理
- [ ] 客户列表（企业客户）
- [ ] 客户详情（基本信息、联系人、历史订单）
- [ ] 客户审核（新注册客户审核）
- [ ] 客户分级（VIP/普通客户）
- [ ] 客户分配（分配给销售代表）
- [ ] 客户跟进记录
- [ ] 客户信用额度管理

#### 3.3.2 订单管理
- [ ] 订单列表（全部订单）
- [ ] 订单详情查看
- [ ] 订单审批（新订单审核）
- [ ] 订单状态更新
- [ ] 订单分配（分配给操作员）
- [ ] 订单异常处理
- [ ] 订单导出
- [ ] **手动录入订单**（ERP暂不对接时）
- [ ] **Excel导入订单**

#### 3.3.3 货物跟踪管理
- [ ] 货物列表（全部货物）
- [ ] 货物详情（包含4portun同步数据）
- [ ] 手动更新货物状态
- [ ] 异常货物标记与处理
- [ ] 货物数据同步日志

#### 3.3.4 财务管理
- [ ] 账单管理（生成/审核/修改账单）
- [ ] 发票管理（开票/邮寄/作废）
- [ ] **收款确认**（线下收款后确认）
- [ ] 对账单管理
- [ ] 财务报表（收入统计、应收款统计）

#### 3.3.5 报价管理
- [ ] 运价维护（各航线运价）
- [ ] 附加费维护
- [ ] 客户专属报价
- [ ] 报价有效期管理

#### 3.3.6 系统管理
- [ ] 账号管理（内部员工账号）
- [ ] 角色权限管理
- [ ] 操作日志审计
- [ ] 系统配置（通知模板、审批流程）
- [ ] 数据字典维护

#### 3.3.7 数据看板
- [ ] 今日数据概览（订单数、在途货物、待处理事项）
- [ ] 业务统计（月度订单量、收入趋势）
- [ ] 客户统计（新增客户、活跃客户）
- [ ] 异常预警（延误货物、待处理订单）

---

### 3.4 系统集成模块

#### 3.4.1 四港物流宝(4portun) API对接（✅ 已有API Key）
- [ ] **箱货跟踪API**
  - 全球70+船司数据
  - 全国10大口岸
  - 节点：放箱、提空、进港、海关放行、码头放行、离港、抵港、卸货、提重、还空
- [ ] **关务数据API 4.0**
  - 海关状态查询
- [ ] **数据订阅模式**：Webhook实时推送
- [ ] **数据缓存与更新**：本地缓存+增量更新

#### 3.4.2 ERP对接（⏸️ 后续评估）
- [ ] **暂不实现自动对接**
- [ ] **手动数据录入**：管理后台支持手动导入/录入订单数据
- [ ] **Excel批量导入**：订单数据批量导入
- [ ] **预留接口**：后续可扩展自动对接

#### 3.4.3 支付系统（⏸️ 后续评估）
- [ ] **暂不接在线支付**
- [ ] **线下对公转账**：账单生成后线下支付
- [ ] **支付凭证上传**：客户上传转账凭证，财务确认
- [ ] **后续可扩展**：微信支付、支付宝

---

### 3.5 AI能力模块（Kimi API）

#### 3.5.1 智能客服
- [ ] 货物状态问答（"我的货到哪里了？"）
- [ ] 运价咨询（"上海到洛杉矶多少钱？"）
- [ ] 船期查询（"下周有去汉堡的船吗？"）
- [ ] 异常处理指引

#### 3.5.2 OCR识别
- [ ] 提单识别（自动提取船名航次、箱号、货描）
- [ ] 发票识别（自动录入费用信息）
- [ ] 装箱单识别

#### 3.5.3 智能预测
- [ ] 到港时间预测

---

## 4. 技术方案（简化版）

### 4.1 架构选择
- **单体架构**（非微服务）- 适合中小企业场景
- **模块化设计** - 代码层面保持模块独立，便于后续拆分

### 4.2 技术栈

| 层级 | 技术 |
|------|------|
| 前端(Web) | Next.js 14 + TypeScript + Tailwind CSS |
| 管理后台 | Next.js 14 + Ant Design Pro |
| 小程序 | 微信小程序原生 + TDesign |
| 后端 | NestJS + TypeScript + Prisma |
| 数据库 | PostgreSQL (阿里云RDS) |
| 缓存 | Redis (阿里云Redis) |
| 文件存储 | 阿里云OSS |
| AI | Kimi API (Moonshot) |
| 部署 | 阿里云ECS + PM2 |

### 4.3 不使用以下技术
- ❌ 微服务架构 - 过度设计
- ❌ Docker + Kubernetes - 增加复杂度
- ❌ Prometheus + Grafana - 使用阿里云监控

---

## 5. 非功能需求

### 5.1 性能要求
| 指标 | 要求 |
|------|------|
| 页面首屏加载 | < 2秒 |
| API响应时间(P95) | < 500ms |
| 并发用户数 | 500+ |
| 日查询量 | 5万+ |

### 5.2 安全要求
- 数据加密传输（HTTPS）
- 敏感数据加密存储
- API访问限流
- 操作审计日志
- 数据备份（每日增量）

### 5.3 部署环境
- **云厂商**：阿里云（已有证书）
- **服务器**：ECS 4核8G起步
- **数据库**：RDS PostgreSQL
- **缓存**：云数据库Redis
- **文件存储**：OSS
- **监控**：阿里云云监控 + SLS日志服务

---

## 6. 项目计划

### 6.1 里程碑

| 阶段 | 周期 | 交付物 |
|------|------|--------|
| 第一阶段 | 3周 | 基础架构、用户认证、货物查询（4portun对接） |
| 第二阶段 | 3周 | 订单管理、财务中心、管理后台 |
| 第三阶段 | 2周 | 小程序、Kimi AI接入 |
| 第四阶段 | 2周 | 测试优化、阿里云部署、上线 |

**总计：10周（约2.5个月）**

### 6.2 团队配置

| 角色 | 人数 |
|------|------|
| 全栈工程师 | 2 |
| 前端工程师 | 1 |
| 项目经理 | 1 |

**共4人**

---

## 7. 成本估算（月度）

| 项目 | 费用 |
|------|------|
| ECS服务器 (4核8G) | ~400元 |
| RDS PostgreSQL | ~500元 |
| Redis | ~200元 |
| OSS存储 | ~100元 |
| CDN | ~100元 |
| Kimi API | ~300元 |
| 4portun API | ~1000元 |
| **总计** | **~2600元/月** |

---

## 8. 待确认事项

- [ ] 客户现有数据量（历史订单、客户数）
- [ ] 是否需要多语言（英文版）
- [ ] 上线时间目标
