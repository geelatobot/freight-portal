# 货代客户门户 - 测试用例文档

## 测试环境配置

### 数据库连接
请在服务器本地配置 `DATABASE_URL` 环境变量，格式：
```bash
DATABASE_URL="mysql://username:password@your-rds-endpoint.mysql.rds.aliyuncs.com:3306/your-database"
```

### 测试执行步骤
```bash
cd backend
npm install
npx prisma migrate deploy
npx prisma generate
npm run test
```

---

## 模块测试清单

### 1. 认证模块 (Auth Module)

| 测试ID | 测试场景 | 预期结果 | 状态 |
|--------|---------|---------|------|
| AUTH-001 | 用户注册 - 正常流程 | 返回用户信息和token | ⏳ |
| AUTH-002 | 用户注册 - 用户名已存在 | 返回400错误 | ⏳ |
| AUTH-003 | 用户注册 - 密码太短 | 返回验证错误 | ⏳ |
| AUTH-004 | 用户登录 - 正常流程 | 返回token和企业列表 | ⏳ |
| AUTH-005 | 用户登录 - 密码错误 | 返回401错误 | ⏳ |
| AUTH-006 | 用户登录 - 用户不存在 | 返回401错误 | ⏳ |
| AUTH-007 | Token刷新 - 正常流程 | 返回新token | ⏳ |
| AUTH-008 | Token刷新 - 无效token | 返回401错误 | ⏳ |
| AUTH-009 | 访问受保护路由 - 无token | 返回401错误 | ⏳ |
| AUTH-010 | 访问受保护路由 - 无效token | 返回401错误 | ⏳ |

### 2. 客户模块 (Customer Module)

| 测试ID | 测试场景 | 预期结果 | 状态 |
|--------|---------|---------|------|
| CUST-001 | 获取用户信息 | 返回用户详情 | ⏳ |
| CUST-002 | 获取企业列表 | 返回企业列表 | ⏳ |
| CUST-003 | 获取企业列表 - 无企业 | 返回空数组 | ⏳ |

### 3. 货物模块 (Shipment Module)

| 测试ID | 测试场景 | 预期结果 | 状态 |
|--------|---------|---------|------|
| SHIP-001 | 查询集装箱 - 本地有数据 | 返回货物信息 | ⏳ |
| SHIP-002 | 查询集装箱 - 需同步4portun | 同步后返回数据 | ⏳ |
| SHIP-003 | 查询集装箱 - 不存在 | 返回404错误 | ⏳ |
| SHIP-004 | 提单查询 | 返回货物列表 | ⏳ |
| SHIP-005 | 获取企业货物列表 | 返回分页列表 | ⏳ |
| SHIP-006 | 获取货物详情 | 返回完整信息 | ⏳ |
| SHIP-007 | Webhook处理 - 正常推送 | 保存节点数据 | ⏳ |
| SHIP-008 | Webhook处理 - 无效签名 | 返回401错误 | ⏳ |

### 4. 订单模块 (Order Module)

| 测试ID | 测试场景 | 预期结果 | 状态 |
|--------|---------|---------|------|
| ORDER-001 | 创建订单 - 正常流程 | 返回订单信息 | ⏳ |
| ORDER-002 | 创建订单 - 缺少必填字段 | 返回验证错误 | ⏳ |
| ORDER-003 | 获取订单列表 | 返回分页列表 | ⏳ |
| ORDER-004 | 获取订单详情 | 返回完整信息 | ⏳ |
| ORDER-005 | 更新订单 | 返回更新后信息 | ⏳ |
| ORDER-006 | 取消订单 - 可取消状态 | 状态变为CANCELLED | ⏳ |
| ORDER-007 | 取消订单 - 不可取消状态 | 返回403错误 | ⏳ |
| ORDER-008 | 更新已完成订单 | 返回403错误 | ⏳ |

### 5. 财务模块 (Billing Module)

| 测试ID | 测试场景 | 预期结果 | 状态 |
|--------|---------|---------|------|
| BILL-001 | 创建账单 | 返回账单信息 | ⏳ |
| BILL-002 | 获取账单列表 | 返回分页列表 | ⏳ |
| BILL-003 | 获取账单详情 | 返回完整信息 | ⏳ |
| BILL-004 | 确认收款 | 更新账单状态 | ⏳ |
| BILL-005 | 获取财务统计 | 返回统计数据 | ⏳ |
| BILL-006 | 部分收款 | 状态为PARTIAL_PAID | ⏳ |
| BILL-007 | 全额收款 | 状态为PAID | ⏳ |

### 6. AI模块 (AI Module)

| 测试ID | 测试场景 | 预期结果 | 状态 |
|--------|---------|---------|------|
| AI-001 | 智能客服对话 | 返回AI回复 | ⏳ |
| AI-002 | 查询货物状态 - 存在 | 返回货物状态描述 | ⏳ |
| AI-003 | 查询货物状态 - 不存在 | 返回未找到提示 | ⏳ |
| AI-004 | AI服务异常 | 返回友好错误 | ⏳ |

### 7. 管理后台模块 (Admin Module)

| 测试ID | 测试场景 | 预期结果 | 状态 |
|--------|---------|---------|------|
| ADMIN-001 | 获取仪表盘数据 | 返回统计数据 | ⏳ |
| ADMIN-002 | 获取客户列表 | 返回分页列表 | ⏳ |
| ADMIN-003 | 更新客户状态 | 状态更新成功 | ⏳ |
| ADMIN-004 | 获取所有订单 | 返回分页列表 | ⏳ |
| ADMIN-005 | 更新订单状态 | 状态更新成功 | ⏳ |
| ADMIN-006 | 获取所有账单 | 返回分页列表 | ⏳ |
| ADMIN-007 | 确认账单收款 | 收款成功 | ⏳ |

---

## 集成测试

### 完整业务流程测试

```
TEST-FLOW-001: 客户注册 → 登录 → 查询货物 → 创建订单 → 查看订单
TEST-FLOW-002: 管理员登录 → 审核客户 → 确认订单 → 创建账单 → 确认收款
TEST-FLOW-003: 4portun Webhook → 货物状态更新 → 客户收到通知
```

---

## 性能测试

| 测试项 | 目标 | 测试方法 |
|--------|------|---------|
| API响应时间 | < 500ms | 使用Apache Bench |
| 并发用户 | 100+ | 使用JMeter |
| 数据库查询 | < 100ms | 使用Prisma日志 |

---

## 问题记录模板

```
## 问题 #{编号}

**测试ID**: {测试用例ID}
**发现时间**: {时间}
**严重程度**: {高/中/低}

**问题描述**:
{详细描述}

**复现步骤**:
1. {步骤1}
2. {步骤2}

**预期结果**:
{预期}

**实际结果**:
{实际}

**错误日志**:
```
{日志内容}
```

**修复状态**: {待修复/修复中/已修复}
**修复提交**: {commit hash}
```

---

## 测试执行记录

### 第一轮测试
- **执行时间**: 
- **测试通过率**: 
- **发现问题数**: 
- **修复问题数**: 

### 第二轮测试
- **执行时间**: 
- **测试通过率**: 
- **发现问题数**: 
- **修复问题数**: 

### 第三轮测试
- **执行时间**: 
- **测试通过率**: 
- **发现问题数**: 
- **修复问题数**: 

---

## 最终验收标准

- [ ] 所有P0测试用例通过
- [ ] API响应时间 < 500ms
- [ ] 无严重级别bug
- [ ] 代码覆盖率 > 80%
