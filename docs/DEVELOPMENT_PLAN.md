# 开发任务执行计划

## 当前迭代目标
完成上线前必须功能：发票管理、支付凭证、性能测试基础

## 任务细化与验收标准

### 任务 1: 发票管理模块 (预计 8 小时)

#### 1.1 数据库设计
- [ ] 创建 `invoices` 表
- [ ] 创建 `invoice_items` 表
- [ ] 创建 `invoice_applications` 申请表
- [ ] Prisma schema 更新

#### 1.2 后端 API 开发
- [ ] POST /invoices/apply - 申请发票
- [ ] GET /invoices - 发票列表
- [ ] GET /invoices/:id - 发票详情
- [ ] PUT /invoices/:id/status - 审核发票
- [ ] GET /invoices/:id/download - 下载发票 PDF

#### 1.3 前端页面
- [ ] 客户端 - 发票申请页面
- [ ] 客户端 - 发票列表页面
- [ ] 管理端 - 发票审核页面

#### 1.4 测试
- [ ] 单元测试 (Service 层)
- [ ] 集成测试 (Controller 层)
- [ ] E2E 测试 (完整流程)

**验收标准**:
- 客户可以申请增值税普通发票/专用发票
- 管理员可以审核通过/拒绝
- 审核通过后可下载 PDF 发票
- 所有测试通过率 100%

---

### 任务 2: 支付凭证管理 (预计 8 小时)

#### 2.1 数据库设计
- [ ] 创建 `payment_vouchers` 表

#### 2.2 后端 API 开发
- [ ] POST /bills/:id/voucher - 上传支付凭证
- [ ] GET /bills/:id/voucher - 查看凭证
- [ ] PUT /bills/:id/voucher/verify - 审核凭证

#### 2.3 前端页面
- [ ] 客户端 - 上传支付凭证
- [ ] 管理端 - 凭证审核

#### 2.4 测试
- [ ] 单元测试
- [ ] 集成测试
- [ ] 文件上传安全测试

**验收标准**:
- 支持上传图片/PDF 凭证
- 文件大小限制 10MB
- 恶意文件上传防护
- 所有测试通过率 100%

---

### 任务 3: 性能测试基础 (预计 6 小时)

#### 3.1 性能测试脚本
- [ ] 安装 Artillery 或 k6
- [ ] 编写 API 性能测试脚本
- [ ] 配置测试场景（登录、查询、创建订单）

#### 3.2 基准测试
- [ ] 单接口响应时间测试
- [ ] 并发用户测试（50/100/200）
- [ ] 数据库查询性能分析

#### 3.3 优化建议
- [ ] 慢查询优化
- [ ] Redis 缓存策略
- [ ] 索引优化

**验收标准**:
- API 平均响应时间 < 200ms
- 支持 100 并发用户
- 生成性能测试报告

---

## 代码 Review 检查清单

每次提交前检查：

- [ ] 代码符合项目编码规范
- [ ] 无 console.log 等调试代码
- [ ] 敏感信息已脱敏（日志、错误信息）
- [ ] 输入验证完整
- [ ] 数据库操作有 try-catch
- [ ] 新增 API 有对应测试
- [ ] 类型定义完整

## 开发流程

1. **代码 Review** - 检查现有代码质量
2. **任务 1: 发票管理** - 开发 → Review → 测试
3. **任务 2: 支付凭证** - 开发 → Review → 测试
4. **任务 3: 性能测试** - 开发 → Review → 测试
5. **回归测试** - 全量测试确保无回归

## 时间规划

| 阶段 | 时间 | 任务 |
|------|------|------|
| Day 1 | 2h | 代码 Review + 发票管理数据库 |
| Day 1 | 4h | 发票管理后端 API |
| Day 1 | 2h | 发票管理测试 |
| Day 2 | 2h | 发票管理前端 + Review |
| Day 2 | 4h | 支付凭证开发 |
| Day 2 | 2h | 支付凭证测试 |
| Day 3 | 4h | 性能测试 |
| Day 3 | 4h | 回归测试 + 优化 |

总计：约 24 小时（3 天）
